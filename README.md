# PostCodeWebApplication

DB* and json also available as files: ClientsSQL.sql, ClientList1.json, ClientList2.json

Database name: ClientsSQL

Database script: 

```sql
CREATE TABLE [dbo].[Client](
	[id] [int] IDENTITY(1,1) PRIMARY KEY,
	[name] [nvarchar](100) NOT NULL,
	[address] [nvarchar](100) NOT NULL,
	[postcode] [nvarchar](7) NULL,
	);
	
CREATE TABLE [dbo].[TransactionLog](
	[command] [nchar](6) NOT NULL,
	[oldname] [nvarchar](100) NULL,
	[oldaddress] [nvarchar](100) NULL,
	[oldpostcode] [nvarchar](7) NULL,
	[newname] [nvarchar](100) NULL,
	[newaddress] [nvarchar](100) NULL,
	[newpostcode] [nvarchar](7) NULL,
	[modified] [datetime] NOT NULL
);

CREATE TRIGGER [dbo].[Transaction_trigger]
ON [dbo].[Client]
AFTER INSERT, UPDATE, DELETE
AS
BEGIN
	DECLARE @operation CHAR(6)
		SET @operation = CASE
				WHEN EXISTS(SELECT * FROM inserted) AND EXISTS(SELECT * FROM deleted)
					THEN 'Update'
				WHEN EXISTS(SELECT * FROM inserted)
					THEN 'Insert'
				WHEN EXISTS(SELECT * FROM deleted)
					THEN 'Delete'
				ELSE NULL
			END

		IF @operation = 'Delete'
			INSERT INTO TransactionLog (command, oldName, oldaddress, oldpostcode, modified)
			SELECT @operation, d.name, d.address, d.postcode, GETDATE()
			from deleted d

		IF @operation = 'Insert'
			INSERT INTO TransactionLog ( command, newname, newaddress, newpostcode, modified)
			SELECT @operation, i.name, i.address, i.postcode ,GETDATE()
			from inserted i

		IF @operation = 'Update'
			INSERT INTO TransactionLog ( command, oldname, oldaddress, oldpostcode, newname, newaddress, newpostcode, modified)
			SELECT @operation, d.name, d.address, d.postcode, i.name, i.address, i.postcode, GETDATE()
			from deleted d, inserted i

END
```


JSON:
```json
[
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 2",
		"Address":"Liepų al. 3-1B, Panevėžys",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 20",
		"Address":"Nemuno g. 70, Panevėžys",
		"PostCode":""
	}
]
```

```json
[
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 2",
		"Address":"Liepų al. 3-1B, Panevėžys",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 3",
		"Address":"Varnių g. 39-9, Kaunas",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 5",
		"Address":"Švenčionių g. 36-2, Nemenčinė, Vilniaus r. sav.",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 7",
		"Address":"Vilniaus g. 220, Šiauliai",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 10",
		"Address":"Baltų pr. 7A-1, Kaunas",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 9",
		"Address":"Vytenio g. 16, Prienai",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 11",
		"Address":"Livonijos g. 5, Joniškis",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 16",
		"Address":"Šiltnamių g. 29, Vilnius",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 18",
		"Address":"Kniaudiškių g. 6, Panevėžys",
		"PostCode":""
	},
	{
		"Name":"UAB \"Gintarinė vaistinė\" fil. nr. 20",
		"Address":"Nemuno g. 70, Panevėžys",
		"PostCode":""
	}
]
```

*Database file as generated by "Microsoft SQL Server Management Studio 18"
